import{t as y,c as v,j as a,R as p,S,z as d,U as T,v as A,N as P,F as R,T as L,V as O}from"./index-ecc61741.js";import{o as q,s as h,t as F}from"./index-98f24b28.js";import{u as k,C as M,T as j}from"./index.esm-5a47d784.js";import{A as $}from"./Alert-dfe8d0dd.js";const D="_profile_3fxmf_1",V="_profile__header_3fxmf_13",w="_profile__actions_3fxmf_21",z="_profile__form_3fxmf_27",B="_profile__avatar_3fxmf_36",Y="_profile__email_3fxmf_37",G="_profile__field_readonly_3fxmf_41",t={profile:D,profile__header:V,profile__actions:w,profile__form:z,profile__avatar:B,profile__email:Y,profile__field_readonly:G},m={"avatar-upload":"_avatar-upload_d8qpf_1","avatar-upload__actions":"_avatar-upload__actions_d8qpf_10","avatar-upload__avatar":"_avatar-upload__avatar_d8qpf_16","avatar-upload__input":"_avatar-upload__input_d8qpf_21","avatar-upload__error":"_avatar-upload__error_d8qpf_27"},K=1024*60,N=["image/jpeg","image/png","image/webp"],W=1e3*3,X=l=>{const[n,e]=v.useState(null),o=v.useRef(null),_=s=>{f();const c=s.target.files?.[0];if(c===void 0)return;const u=i(c);if(u!==null){g(u);return}l.changeImage(c)},f=()=>{e(null),o.current=null},i=s=>N.includes(s.type)?s.size>K?"Max file size - 60 Kb":null:"Accept image type: jpeg/jpg, png, webp",g=s=>{e(s),o.current=setTimeout(f,W)},x=()=>{l.changeImage(null)};return a.jsxs(p,{className:`${m["avatar-upload"]} ${l.className??""}`,children:[a.jsx(S,{alt:"Current user avatar",className:m["avatar-upload__avatar"],src:l.imageUrl??void 0}),!l.disable&&a.jsxs(p,{className:m["avatar-upload__actions"],children:[a.jsxs(d,{children:["Upload",a.jsx("input",{type:"file",onChange:_,accept:N.join(", "),className:m["avatar-upload__input"]})]}),a.jsx(d,{color:"error",onClick:x,children:"Delete"})]}),n!==null&&a.jsx($,{severity:"error",className:m["avatar-upload__error"],children:n})]})},Z=y(X),H=q({firstName:h().trim().min(1,"Enter first name"),lastName:h().trim().min(1,"Enter last name"),avatarUrl:h().nullable()}),J={avatarUrl:null,email:"",firstName:"",lastName:""},Q=()=>{const{user:l,isLoading:n}=T(),[e,o]=v.useState(!0),{register:_,handleSubmit:f,formState:{errors:i},setValue:g,control:x}=k({defaultValues:l??J,resolver:F(H)}),[s,c]=v.useState(null),u=A(),E=r=>{u(O.updateCurrentUser({image:s,user:r})),o(!0)},C=()=>{o(r=>!r)},I=()=>{o(!0)},U=r=>{const b=r?URL.createObjectURL(r):null;c(r),g("avatarUrl",b)};return!n&&l===null?a.jsx(P,{to:"/"}):a.jsxs(p,{className:t.profile,children:[n&&a.jsx(R,{}),a.jsxs(p,{className:t.profile__header,children:[a.jsx(L,{variant:"h4",children:"Profile"}),a.jsx(p,{className:t.profile__actions,children:e?a.jsx(d,{color:"primary",onClick:C,children:"Edit"}):a.jsxs(a.Fragment,{children:[a.jsx(d,{onClick:I,children:"Cancel"}),a.jsx(d,{variant:"contained",type:"submit",onClick:f(E),children:"Save"})]})})]}),a.jsxs("form",{className:t.profile__form,children:[a.jsx(M,{name:"avatarUrl",control:x,render:({field:r})=>a.jsx(Z,{imageUrl:r.value,className:t.profile__avatar,disable:e,changeImage:U})}),a.jsx(j,{className:e?t.profile__field_readonly:"",InputProps:{readOnly:e},id:"firstName",required:!0,autoComplete:"given-name",error:i.firstName!==void 0,helperText:i.firstName?.message??"",label:"First name",variant:"standard",..._("firstName")}),a.jsx(j,{className:e?t.profile__field_readonly:"",id:"lastName",InputProps:{readOnly:e},required:!0,autoComplete:"family-name",error:i.lastName!==void 0,helperText:i.lastName?.message??"",label:"Last name",variant:"standard",..._("lastName")}),a.jsx(j,{className:`${t.profile__email} ${t.profile__field_readonly}`,id:"email",InputProps:{readOnly:e},autoComplete:"email",label:"Email",variant:"standard",..._("email")})]})]})},la=y(Q);export{la as ProfilePage};
