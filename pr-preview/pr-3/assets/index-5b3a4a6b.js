var p=Object.defineProperty;var y=(r,e,t)=>e in r?p(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var l=(r,e,t)=>(y(r,typeof e!="symbol"?e+"":e,t),t);import"./modulepreload-polyfill-3cfb730f.js";class a{constructor(){l(this,"subscribers",[])}subscribe(e){this.subscribers=[...this.subscribers,e]}unsubscribe(e){this.subscribers=this.subscribers.filter(t=>t!==e)}notify(e){this.subscribers.forEach(t=>{t.update(e)})}}function b(r,e){const t=r+Math.random()*(e+1-r);return Math.floor(t)}class R extends a{update(e){this.notify({...e,diceResult:b(1,6)})}}class _ extends a{constructor(){super(...arguments);l(this,"playersCount",0);l(this,"currentPlayerIndex",0)}turn(){const t=(this.currentPlayerIndex+1)%this.playersCount;this.notify({currentPlayerIndex:this.currentPlayerIndex,nextPlayerIndex:t}),this.currentPlayerIndex=t}}class x extends a{constructor(){super(...arguments);l(this,"turnResults",[])}update(t){this.turnResults=[...this.turnResults,t.diceResult],this.notify({turnResults:this.turnResults})}}class c{constructor(){l(this,"resultHtml",null);l(this,"resultTurnsDataHtml",null);l(this,"resultScoreHtml",null)}render(e,t){const s=document.querySelector(".blackjack__results");if(s===null)return;const n=this.createResultRootElement(t),{resultInfo:u,resultScore:i}=this.createResultInfoElement(e),d=this.createResultIndicatorElement(),{resultTurns:m,resultTurnsData:h}=this.createResultTurnsElement();n.appendChild(u),n.appendChild(d),n.appendChild(m),s.appendChild(n),this.resultHtml=n,this.resultTurnsDataHtml=h,this.resultScoreHtml=i}update(e){this.resultHtml===null||this.resultTurnsDataHtml===null||this.resultScoreHtml===null||(e.isActive?this.resultHtml.classList.add("result-item_active"):this.resultHtml.classList.remove("result-item_active"),e.isWinner&&this.resultHtml.classList.add("result-item_winner"),this.resultTurnsDataHtml.textContent=e.turnResults.join(""),this.resultScoreHtml.textContent=`${e.turnResults.reduce((t,s)=>t+s,0)} points`)}createResultRootElement(e){const t=document.createElement("div");return t.className=`blackjack__result-item result-item ${e??""}`,t}createResultInfoElement(e){const t=document.createElement("p");t.className="result-item__player-name typography-subtitle",t.textContent=e;const s=document.createElement("p");s.className="result-item__player-points typography-subtitle",s.textContent="0 points";const n=document.createElement("div");return n.className="result-item__player-info",n.appendChild(t),n.appendChild(s),{resultInfo:n,resultScore:s}}createResultIndicatorElement(){const e=document.createElement("div");return e.className="result_item__indicator",e}createResultTurnsElement(){const e=document.createElement("p");e.className="result_item__moves-subtitle typography-subtitle",e.textContent="Moves";const t=document.createElement("p");t.className="result-item__moves-data typography-body";const s=document.createElement("div");return s.className="result-item__moves",s.appendChild(e),s.appendChild(t),{resultTurns:s,resultTurnsData:t}}}const I=21;class o extends a{constructor(t){super();l(this,"turnResults",[]);this.playerIndex=t}update(t){let s=this.turnResults.reduce((u,i)=>u+i,0);t.currentPlayerIndex===this.playerIndex&&(s+=t.diceResult,this.turnResults=[...this.turnResults,t.diceResult]);const n={isActive:t.nextPlayerIndex===this.playerIndex,isWinner:s>=I,turnResults:this.turnResults};this.notify(n)}}class f{constructor(){l(this,"turnGenerator");l(this,"diceGenerator");l(this,"playersCount",0);this.turnGenerator=new _,this.diceGenerator=new R}init(){const e=new c;e.render("Player One");const t=new o(0);t.subscribe(e);const s=new c;s.render("Player Second");const n=new o(1);n.subscribe(s);const u=new c;u.render("Dice","game-result");const i=new x;i.subscribe(u),this.diceGenerator.subscribe(i),this.diceGenerator.subscribe(t),this.diceGenerator.subscribe(n),this.turnGenerator.subscribe(this.diceGenerator),this.playersCount=2,this.turnGenerator.playersCount=this.playersCount,this.listenMove()}listenMove(){const e=document.querySelector(".blackjack__turn-button");e&&e.addEventListener("click",()=>{this.turnGenerator.turn()})}}const C=new f;C.init();
