var y=Object.defineProperty;var b=(s,e,t)=>e in s?y(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var l=(s,e,t)=>(b(s,typeof e!="symbol"?e+"":e,t),t);import"./modulepreload-polyfill-3cfb730f.js";class d{constructor(){l(this,"subscribers",[])}subscribe(e){this.subscribers=[...this.subscribers,e]}unsubscribe(e){this.subscribers=this.subscribers.filter(t=>t!==e)}notify(e){this.subscribers.forEach(t=>{t.update(e)})}}function I(s,e){const t=s+Math.random()*(e+1-s);return Math.floor(t)}function P(s,e,t){const r=document.createElement("p");r.className="result-item__player-name typography-subtitle",r.textContent=e;const n=document.createElement("p");n.className="result-item__player-points typography-subtitle",n.textContent="0 points";const a=document.createElement("div");a.className="result-item__player-info",a.appendChild(r),a.appendChild(n);const i=document.createElement("div");i.className="result_item__indicator";const h=document.createElement("p");h.className="result_item__moves-subtitle typography-subtitle",h.textContent="Moves";const m=document.createElement("p");m.className="result-item__moves-data typography-body";const c=document.createElement("div");c.className="result-item__moves",c.appendChild(h),c.appendChild(m);const u=document.createElement("div");return u.className=`blackjack__result-item result-item ${t??""}`,u.appendChild(a),u.appendChild(i),u.appendChild(c),s.appendChild(u),{resultHtml:u,resultTurnsDataHtml:m,resultScoreHtml:n}}class _ extends d{update(e){this.notify({...e,diceSide:I(1,6)})}}class S extends d{constructor(){super();l(this,"playersIds",[]);l(this,"currentPlayerIndex",0);this.turn=this.turn.bind(this)}turn(){const t=(this.currentPlayerIndex+1)%this.playersIds.length,r=this.playersIds[t];this.notify({currentPlayerId:this.playersIds[this.currentPlayerIndex],nextPlayerId:r}),this.currentPlayerIndex=t}updatePlayers(t){this.playersIds=t}}class f extends d{constructor(){super(...arguments);l(this,"rollValues",[])}update(t){this.rollValues=[...this.rollValues,t.diceSide],this.notify({status:[],turnValues:this.rollValues})}}var o=(s=>(s.Active="result-item_active",s.Win="result-item_winning",s))(o||{});class p{constructor(e,t){l(this,"resultHtml",null);l(this,"resultTurnsDataHtml",null);l(this,"resultScoreHtml",null);const r=document.querySelector(".blackjack__results");r!==null&&this.createElement(r,e,t)}update(e){this.resultHtml===null||this.resultTurnsDataHtml===null||this.resultScoreHtml===null||(this.resultHtml.classList.remove(o.Active),e.status.length>0&&(this.resultHtml.className+=` ${e.status.join(" ")}`),this.resultTurnsDataHtml.textContent=e.turnValues.join(""),this.resultScoreHtml.textContent=`${e.turnValues.reduce((t,r)=>t+r,0)} points`)}createElement(e,t,r){const{resultHtml:n,resultTurnsDataHtml:a,resultScoreHtml:i}=P(e,t,r);this.resultHtml=n,this.resultTurnsDataHtml=a,this.resultScoreHtml=i}}const v=21;class G extends d{constructor(t){super();l(this,"rollValues",[]);this.playerId=t}update(t){let r=this.rollValues.reduce((a,i)=>a+i,0);t.currentPlayerId===this.playerId&&(r+=t.diceSide,this.rollValues=[...this.rollValues,t.diceSide]);const n={status:this.getPlayerStatus(r,t.nextPlayerId===this.playerId),turnValues:this.rollValues};this.notify(n)}getPlayerStatus(t,r){const n=[];return t>=v&&n.push(o.Win),r&&n.push(o.Active),n}}class H{constructor(){l(this,"turnGenerator");l(this,"diceGenerator");l(this,"playerIds",[]);l(this,"lastPlayerId",0)}init(){this.turnGenerator=new S,this.diceGenerator=new _,this.addPlayerStatus("Player One"),this.addPlayerStatus("Player Two"),this.addGameStatus(),this.turnGenerator.subscribe(this.diceGenerator),this.listenMove()}addPlayerStatus(e){if(this.turnGenerator===void 0||this.diceGenerator===void 0)return;this.lastPlayerId+=1,this.playerIds=[...this.playerIds,this.lastPlayerId];const t=new G(this.lastPlayerId),r=new p(e);t.subscribe(r),this.diceGenerator.subscribe(t),this.turnGenerator.updatePlayers(this.playerIds)}addGameStatus(){if(this.diceGenerator===void 0)return;const e=new f,t=new p("Dice","game-result");e.subscribe(t),this.diceGenerator.subscribe(e)}listenMove(){if(this.turnGenerator===void 0)return;const e=document.querySelector(".blackjack__turn-button");e&&e.addEventListener("click",this.turnGenerator.turn)}}const x=new H;x.init();
