var p=Object.defineProperty;var y=(r,e,t)=>e in r?p(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>(y(r,typeof e!="symbol"?e+"":e,t),t);import"./modulepreload-polyfill-3cfb730f.js";class u{constructor(){n(this,"subscribers",[])}subscribe(e){this.subscribers=[...this.subscribers,e]}unsubscribe(e){this.subscribers=this.subscribers.filter(t=>t!==e)}notify(e){this.subscribers.forEach(t=>{t.update(e)})}}function b(r,e){const t=r+Math.random()*(e+1-r);return Math.floor(t)}class I extends u{update(e){this.notify({...e,diceSide:b(1,6)})}}class P extends u{constructor(){super(...arguments);n(this,"playersIds",[]);n(this,"currentPlayerIndex",0)}turn(){const t=(this.currentPlayerIndex+1)%this.playersIds.length,s=this.playersIds[t];this.notify({currentPlayerId:this.playersIds[this.currentPlayerIndex],nextPlayerId:s}),this.currentPlayerIndex=t}updatePlayers(t){this.playersIds=t}}class _ extends u{constructor(){super(...arguments);n(this,"rollValues",[])}update(t){this.rollValues=[...this.rollValues,t.diceSide],this.notify({status:[],turnValues:this.rollValues})}}var a=(r=>(r.Active="result-item_active",r.Win="result-item_winning",r))(a||{});class o{constructor(e,t){n(this,"resultHtml",null);n(this,"resultTurnsDataHtml",null);n(this,"resultScoreHtml",null);const s=document.querySelector(".blackjack__results");if(s===null)return;const l=this.createResultRootElement(t),{resultInfo:i,resultScore:c}=this.createResultInfoElement(e),d=this.createResultIndicatorElement(),{resultTurns:h,resultTurnsData:m}=this.createResultTurnsElement();l.appendChild(i),l.appendChild(d),l.appendChild(h),s.appendChild(l),this.resultHtml=l,this.resultTurnsDataHtml=m,this.resultScoreHtml=c}update(e){this.resultHtml===null||this.resultTurnsDataHtml===null||this.resultScoreHtml===null||(this.resultHtml.classList.remove(a.Active),e.status.length>0&&(this.resultHtml.className+=` ${e.status.join(" ")}`),this.resultTurnsDataHtml.textContent=e.turnValues.join(""),this.resultScoreHtml.textContent=`${e.turnValues.reduce((t,s)=>t+s,0)} points`)}createResultRootElement(e){const t=document.createElement("div");return t.className=`blackjack__result-item result-item ${e??""}`,t}createResultInfoElement(e){const t=document.createElement("p");t.className="result-item__player-name typography-subtitle",t.textContent=e;const s=document.createElement("p");s.className="result-item__player-points typography-subtitle",s.textContent="0 points";const l=document.createElement("div");return l.className="result-item__player-info",l.appendChild(t),l.appendChild(s),{resultInfo:l,resultScore:s}}createResultIndicatorElement(){const e=document.createElement("div");return e.className="result_item__indicator",e}createResultTurnsElement(){const e=document.createElement("p");e.className="result_item__moves-subtitle typography-subtitle",e.textContent="Moves";const t=document.createElement("p");t.className="result-item__moves-data typography-body";const s=document.createElement("div");return s.className="result-item__moves",s.appendChild(e),s.appendChild(t),{resultTurns:s,resultTurnsData:t}}}const f=21;class S extends u{constructor(t){super();n(this,"rollValues",[]);this.playerId=t}update(t){let s=this.rollValues.reduce((i,c)=>i+c,0);t.currentPlayerId===this.playerId&&(s+=t.diceSide,this.rollValues=[...this.rollValues,t.diceSide]);const l={status:this.getPlayerStatus(s,t.nextPlayerId===this.playerId),turnValues:this.rollValues};this.notify(l)}getPlayerStatus(t,s){const l=[];return t>=f&&l.push(a.Win),s&&l.push(a.Active),l}}class v{constructor(){n(this,"turnGenerator");n(this,"diceGenerator");n(this,"playerIds",[]);n(this,"lastPlayerId",0);this.turnGenerator=new P,this.diceGenerator=new I}init(){this.addPlayerStatus("Player One"),this.addPlayerStatus("Player Two"),this.addGameStatus(),this.turnGenerator.subscribe(this.diceGenerator),this.listenMove()}addPlayerStatus(e){this.lastPlayerId+=1,this.playerIds=[...this.playerIds,this.lastPlayerId];const t=new S(this.lastPlayerId),s=new o(e);t.subscribe(s),this.diceGenerator.subscribe(t),this.turnGenerator.updatePlayers(this.playerIds)}addGameStatus(){const e=new _,t=new o("Dice","game-result");e.subscribe(t),this.diceGenerator.subscribe(e)}listenMove(){const e=document.querySelector(".blackjack__turn-button");e&&e.addEventListener("click",()=>{this.turnGenerator.turn()})}}const E=new v;E.init();
