var y=Object.defineProperty;var b=(s,e,t)=>e in s?y(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var l=(s,e,t)=>(b(s,typeof e!="symbol"?e+"":e,t),t);import"./modulepreload-polyfill-3cfb730f.js";class d{constructor(){l(this,"subscribers",[])}subscribe(e){this.subscribers=[...this.subscribers,e]}unsubscribe(e){this.subscribers=this.subscribers.filter(t=>t!==e)}notify(e){this.subscribers.forEach(t=>{t.update(e)})}}function I(s,e){const t=s+Math.random()*(e+1-s);return Math.floor(t)}function v(s,e,t){const r=document.createElement("p");r.className="result-item__player-name typography-subtitle",r.textContent=e;const a=document.createElement("p");a.className="result-item__player-points typography-subtitle",a.textContent="0 points";const n=document.createElement("div");n.className="result-item__player-info",n.appendChild(r),n.appendChild(a);const i=document.createElement("div");i.className="result_item__indicator";const h=document.createElement("p");h.className="result_item__moves-subtitle typography-subtitle",h.textContent="Moves";const m=document.createElement("p");m.className="result-item__moves-data typography-body";const o=document.createElement("div");o.className="result-item__moves",o.appendChild(h),o.appendChild(m);const u=document.createElement("div");return u.className=`blackjack__result-item result-item ${t??""}`,u.appendChild(n),u.appendChild(i),u.appendChild(o),s.appendChild(u),{resultHtml:u,resultMovesDataHtml:m,resultScoreHtml:a}}class P extends d{update(e){this.notify({...e,diceSide:I(1,6)})}}class _ extends d{constructor(){super();l(this,"playersIds",[]);l(this,"currentPlayerIndex",0);this.turn=this.turn.bind(this)}turn(){const t=(this.currentPlayerIndex+1)%this.playersIds.length,r=this.playersIds[t];this.notify({currentPlayerId:this.playersIds[this.currentPlayerIndex],nextPlayerId:r}),this.currentPlayerIndex=t}updatePlayers(t){this.playersIds=t}}class S extends d{constructor(){super(...arguments);l(this,"rollValues",[])}update(t){this.rollValues=[...this.rollValues,t.diceSide],this.notify({status:[],rollValues:this.rollValues})}}var c=(s=>(s.Active="result-item_active",s.Win="result-item_winning",s))(c||{});class p{constructor(e,t){l(this,"resultHtml",null);l(this,"resultMovesHtml",null);l(this,"resultScoreHtml",null);const r=document.querySelector(".blackjack__results");r!==null&&this.createElement(r,e,t)}update(e){this.resultHtml===null||this.resultMovesHtml===null||this.resultScoreHtml===null||(this.resultHtml.classList.remove(c.Active),e.status.length>0&&(this.resultHtml.className+=` ${e.status.join(" ")}`),this.resultMovesHtml.textContent=e.rollValues.join(""),this.resultScoreHtml.textContent=`${e.rollValues.reduce((t,r)=>t+r,0)} points`)}createElement(e,t,r){const{resultHtml:a,resultMovesDataHtml:n,resultScoreHtml:i}=v(e,t,r);this.resultHtml=a,this.resultMovesHtml=n,this.resultScoreHtml=i}}const H=21;class f extends d{constructor(t){super();l(this,"rollValues",[]);this.playerId=t}update(t){let r=this.rollValues.reduce((n,i)=>n+i,0);t.currentPlayerId===this.playerId&&(r+=t.diceSide,this.rollValues=[...this.rollValues,t.diceSide]);const a={status:this.getPlayerStatus(r,t.nextPlayerId===this.playerId),rollValues:this.rollValues};this.notify(a)}getPlayerStatus(t,r){const a=[];return t>=H&&a.push(c.Win),r&&a.push(c.Active),a}}class G{constructor(){l(this,"turnGenerator");l(this,"diceGenerator");l(this,"playerIds",[]);l(this,"lastPlayerId",0);this.turnGenerator=new _,this.diceGenerator=new P,this.addPlayerStatus("Player One"),this.addPlayerStatus("Player Two"),this.addGameStatus(),this.turnGenerator.subscribe(this.diceGenerator),this.listenMove()}addPlayerStatus(e){this.lastPlayerId+=1,this.playerIds=[...this.playerIds,this.lastPlayerId];const t=new f(this.lastPlayerId),r=new p(e);t.subscribe(r),this.diceGenerator.subscribe(t),this.turnGenerator.updatePlayers(this.playerIds)}addGameStatus(){const e=new S,t=new p("Dice","game-result");e.subscribe(t),this.diceGenerator.subscribe(e)}listenMove(){const e=document.querySelector(".blackjack__turn-button");e&&e.addEventListener("click",this.turnGenerator.turn)}}new G;
