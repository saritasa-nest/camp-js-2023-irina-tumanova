var m=Object.defineProperty;var d=(n,e,t)=>e in n?m(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var r=(n,e,t)=>(d(n,typeof e!="symbol"?e+"":e,t),t);import"./modulepreload-polyfill-3cfb730f.js";class o{constructor(){r(this,"subscribers",new Set)}subscribe(e){this.subscribers.add(e)}unsubscribe(e){this.subscribers.delete(e)}notify(e){this.subscribers.forEach(t=>{t.update(e)})}}function p(n,e){return Math.floor(n+Math.random()*(e+1-n))}class h extends o{update(e){this.notify({...e,dice:p(1,6)})}}class b extends o{constructor(){super(...arguments);r(this,"playersCount",0);r(this,"currentPlayerId",0)}turn(){const t=(this.currentPlayerId+1)%this.playersCount;this.notify({currentPlayerId:this.currentPlayerId,nextPlayerId:t}),this.currentPlayerId=t}}class c extends o{constructor(){super(...arguments);r(this,"results",[])}next(t){const s=[...this.results,t];this.results=s,this.notify(s)}getScore(){return this.results.reduce((t,s)=>t+s,0)}}class y{constructor(){r(this,"results",new c)}update(e){this.results.next(e.dice)}}const C=21;class E{constructor(e){r(this,"results",new c);r(this,"isActive",new o);r(this,"isWinner",new o);this.player=e}update(e){e.currentPlayerId===this.player.id&&this.results.next(e.dice),this.isActive.notify(e.nextPlayerId===this.player.id),this.isWinner.notify(this.results.getScore()>=C)}}class _{constructor(){r(this,"resultInfoElement",null);r(this,"resultScoreElement",null)}render(e){const t=document.createElement("p");t.className="result-item__player-name typography-subtitle",t.textContent=e;const s=document.createElement("p");s.className="result-item__player-points typography-subtitle",s.textContent="0 points";const l=document.createElement("div");l.className="result-item__player-info",l.appendChild(t),l.appendChild(s),this.resultInfoElement=l,this.resultScoreElement=s}update(e){this.resultScoreElement!==null&&(this.resultScoreElement.textContent=`${e.reduce((t,s)=>t+s,0)} points`)}}class f{constructor(){r(this,"resultStatusElement",null)}render(){const e=document.createElement("div");e.className="result_item__indicator",this.resultStatusElement=e}update(e){this.resultStatusElement!==null&&(e?this.resultStatusElement.classList.add("result_item__indicator_active"):this.resultStatusElement.classList.remove("result_item__indicator_active"))}}class S{constructor(){r(this,"resultTurnsElement",null);r(this,"resultTurnsDataElement",null)}render(){const e=document.createElement("p");e.className="result_item__moves-subtitle typography-subtitle",e.textContent="Moves";const t=document.createElement("p");t.className="result-item__moves-data typography-body";const s=document.createElement("div");s.className="result-item__moves",s.appendChild(e),s.appendChild(t),this.resultTurnsElement=s,this.resultTurnsDataElement=t}update(e){this.resultTurnsDataElement!==null&&(this.resultTurnsDataElement.textContent=e.join(""))}}class I{constructor(){r(this,"resultElement",null)}render({resultInfo:e,resultStatus:t,resultTurns:s,className:l}){const i=document.querySelector(".blackjack__results");if(i===null)return;const u=document.createElement("div");u.className=`blackjack__result-item result-item ${l??""}`,e!==null&&u.appendChild(e),t!==null&&u.appendChild(t),s!==null&&u.appendChild(s),i.appendChild(u),this.resultElement=u}update(e){this.resultElement!==null&&e&&this.resultElement.classList.add("result-item_winner")}}const a=[{name:"Player First",id:0},{name:"Player Second",id:1}];class T{constructor(){r(this,"turnGenerator",new b);r(this,"diceGenerator",new h)}init(){a.forEach((e,t)=>this.initPlayer({...e,id:t})),this.turnGenerator.playersCount=a.length,this.initDiceResults(),this.turnGenerator.subscribe(this.diceGenerator),this.listenTurn()}initPlayer(e){const t=this.createResultComponents(e.name),s=new E(e);s.results.subscribe(t.resultInfoComponent),s.results.subscribe(t.resultTurnsComponent),s.isActive.subscribe(t.resultStatusComponent),s.isWinner.subscribe(t.resultComponent),this.diceGenerator.subscribe(s)}initDiceResults(){const e=this.createResultComponents("Dice","result-items_total-dices"),t=new y;t.results.subscribe(e.resultInfoComponent),t.results.subscribe(e.resultTurnsComponent),this.diceGenerator.subscribe(t)}createResultComponents(e,t){const s=new _;s.render(e);const l=new f;l.render();const i=new S;i.render();const u=new I;return u.render({resultInfo:s.resultInfoElement,resultStatus:l.resultStatusElement,resultTurns:i.resultTurnsElement,className:t}),{resultComponent:u,resultInfoComponent:s,resultStatusComponent:l,resultTurnsComponent:i}}listenTurn(){const e=document.querySelector(".blackjack__turn-button");e&&e.addEventListener("click",()=>{this.turnGenerator.turn()})}}const v=new T;v.init();
