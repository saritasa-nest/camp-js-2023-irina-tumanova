var y=Object.defineProperty;var b=(r,t,e)=>t in r?y(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var n=(r,t,e)=>(b(r,typeof t!="symbol"?t+"":t,e),e);import"./modulepreload-polyfill-3cfb730f.js";class c{constructor(){n(this,"subscribers",[])}subscribe(t){this.subscribers=[...this.subscribers,t]}unsubscribe(t){this.subscribers=this.subscribers.filter(e=>e!==t)}notify(t){this.subscribers.forEach(e=>{e.update(t)})}}class v extends c{update(t){const e=this.generateRandomNumber(1,7),s={...t,diceSide:e};this.notify(s)}generateRandomNumber(t,e){const s=t+Math.random()*(e-t);return Math.floor(s)}}class _ extends c{constructor(){super();n(this,"playersIds",[]);n(this,"currentPlayerIndex",0);this.move=this.move.bind(this)}move(){const e=(this.currentPlayerIndex+1)%this.playersIds.length,s=this.playersIds[e],l={currentPlayerId:this.playersIds[this.currentPlayerIndex],nextPlayerId:s};this.notify(l),this.currentPlayerIndex=e}updatePlayers(e){this.playersIds=e}}class I extends c{constructor(){super(...arguments);n(this,"results",[])}update(e){this.results=[...this.results,e.diceSide];const s={status:[],results:this.results};this.notify(s)}}function H(r,t,e){const s=document.createElement("div");s.className=`blackjack__result-item result-item ${e??""}`;const l=document.createElement("div");l.className="result-item__player__info";const a=document.createElement("p");a.className="result-item__player__name typography-subtitle",a.textContent=t;const i=document.createElement("p");i.className="result-item__player__points typography-subtitle",i.textContent="0 points",l.appendChild(a),l.appendChild(i);const h=document.createElement("div");h.className="result_item__indicator";const u=document.createElement("div");u.className="result-item__moves";const d=document.createElement("p");d.className="result_item__moves__subtitle typography-subtitle",d.textContent="Moves";const m=document.createElement("div");return m.className="result-item__moves__data typography-body",u.appendChild(d),u.appendChild(m),s.appendChild(l),s.appendChild(h),s.appendChild(u),r.appendChild(s),{resultHtml:s,resultMovesDataHtml:m,resultScoreHtml:i}}var o=(r=>(r.Inactive="inactive",r.Active="active",r.Win="winning",r))(o||{});class p{constructor(t,e){n(this,"resultHtml",null);n(this,"resultMovesHtml",null);n(this,"resultScoreHtml",null);const s=document.querySelector(".blackjack__results");s!==null&&this.createElement(s,t,e)}update(t){if(this.resultHtml===null||this.resultMovesHtml===null||this.resultScoreHtml===null||(this.resultHtml.classList.remove(o.Active),t.status.length>0&&(this.resultHtml.className+=` ${t.status.join(" ")}`),t.results===void 0))return;const e=document.createElement("p");e.innerText=`${t.results[t.results.length-1]}`,this.resultMovesHtml.appendChild(e),this.resultScoreHtml.textContent=`${t.results.reduce((s,l)=>s+l,0)} points`}createElement(t,e,s){const{resultHtml:l,resultMovesDataHtml:a,resultScoreHtml:i}=H(t,e,s);this.resultHtml=l,this.resultMovesHtml=a,this.resultScoreHtml=i}}class P extends c{constructor(e){super();n(this,"results",[]);n(this,"winningPoints",21);this.playerId=e}update(e){let s=this.results.reduce((a,i)=>a+i,0);e.currentPlayerId===this.playerId&&(s+=e.diceSide,this.results=[...this.results,e.diceSide]);const l={status:this.getPlayerStatus(s,e.nextPlayerId===this.playerId),results:this.playerId===e.currentPlayerId?this.results:void 0};this.notify(l)}getPlayerStatus(e,s){const l=[];return e>=this.winningPoints&&l.push(o.Win),s&&l.push(o.Active),l}}class f{constructor(){n(this,"moveGenerator");n(this,"diceGenerator");n(this,"playerIds",[]);n(this,"lastPlayerId",0);this.moveGenerator=new _,this.diceGenerator=new v,this.addPlayerStatus("Computer"),this.addPlayerStatus("You"),this.addGameStatus(),this.moveGenerator.subscribe(this.diceGenerator),this.listenMove()}addPlayerStatus(t){this.lastPlayerId+=1,this.playerIds=[...this.playerIds,this.lastPlayerId];const e=new P(this.lastPlayerId),s=new p(t);e.subscribe(s),this.diceGenerator.subscribe(e),this.moveGenerator.updatePlayers(this.playerIds)}addGameStatus(){const t=new I,e=new p("Dice","game-result");t.subscribe(e),this.diceGenerator.subscribe(t)}listenMove(){var t;(t=document.querySelector(".blackjack__turn-button"))==null||t.addEventListener("click",this.moveGenerator.move)}}new f;
