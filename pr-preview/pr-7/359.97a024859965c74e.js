"use strict";(self.webpackChunkangular=self.webpackChunkangular||[]).push([[359],{8359:(ge,E,s)=>{s.r(E),s.d(E,{AuthModule:()=>pe});var u,t,l=s(89),_=s(2074),O=s(2355),m=s(2369),i=s(6652),f=s(1300),Z=s(2151),c=s(6789),v=s(4926),e=s(4355),w=s(5081),x=s(4121),C=s(9676),p=s(8168),N=s(5490),b=s(2522);(t=u||(u={})).MIN_PASSWORD_LENGTH=8,t.passwordRepetition=function o(){return r=>{if(r instanceof i.cw){const{password:n,repeatedPassword:a}=r.controls;if(a.value.length<t.MIN_PASSWORD_LENGTH)return null;a.setErrors(n.value!==a.value?{passwordDoesNotMatch:!0}:null)}return null}};var J=s(3568),L=s(4945),F=s(3787);const P="common",U={[P]:[]};class q{constructor({code:o,detail:r}){this.code=o,this.detail=r}}var T;!function(t){t.fromDto=function o(r){const n={common:[]};return r.forEach(a=>{const g=new q({code:a.code,detail:a.detail});n[null===a.attr?P:a.attr]=[...n[P],g]}),n}}(T||(T={}));var M=s(6738);function I(){return function(t){return t.pipe((0,J.K)(o=>o instanceof M.UA&&o.error.errors instanceof Array?(0,L.of)(T.fromDto(o.error.errors)):(0,F._)(()=>o)))}}var y=s(8598);let Q=(()=>{class t{transform(r){return`${r[0].toUpperCase()}${r.slice(1).toLowerCase()}`}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275pipe=e.Yjl({name:"sentensecase",type:t,pure:!1}),t})();var h;!function(t){let o;var a;(a=o=t.AppErrorCode||(t.AppErrorCode={})).Required="required",a.MinLength="minlength",a.Email="email",a.PasswordRepetition="passwordRepetition",a.ServerError="serverError";const r={[o.Required]:a=>`Please enter ${a}`,[o.MinLength]:a=>"Min characters: ",[o.Email]:a=>"Invalid email",[o.PasswordRepetition]:a=>"Repeated password doesn't match",[o.ServerError]:a=>"Server error"};t.toReadableAppError=function n(a,g){return r[a](g)}}(h||(h={}));let A=(()=>{class t{transform(r,n=""){return h.toReadableAppError(r,n)}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275pipe=e.Yjl({name:"fieldErrorText",type:t,pure:!1}),t})();function Y(t,o){if(1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"fieldErrorText"),e.qZA()),2&t){const r=e.oxw(2);e.xp6(1),e.Oqu(e.xi3(2,1,"required",r.fieldName))}}function B(t,o){1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"fieldErrorText"),e.qZA()),2&t&&(e.xp6(1),e.hij("",e.lcZ(2,1,"minlength")," 8"))}function D(t,o){if(1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"fieldErrorText"),e.qZA()),2&t){const r=e.oxw(2);e.xp6(1),e.Oqu(e.xi3(2,1,"passwordRepetition",r.fieldName))}}function H(t,o){if(1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.qZA()),2&t){const r=o.ngIf;e.xp6(1),e.Oqu(r)}}function j(t,o){if(1&t){const r=e.EpF();e.TgZ(0,"mat-form-field",1)(1,"mat-label"),e._uU(2),e.ALo(3,"sentensecase"),e.qZA(),e._UZ(4,"input",2),e.TgZ(5,"button",3),e.NdJ("click",function(){e.CHM(r);const a=e.oxw();return e.KtG(a.changePasswordVisibility())}),e.TgZ(6,"mat-icon"),e._uU(7),e.qZA()(),e.YNc(8,Y,3,4,"mat-error",4),e.YNc(9,B,3,3,"mat-error",4),e.YNc(10,D,3,4,"mat-error",4),e.YNc(11,H,2,1,"mat-error",4),e.qZA()}if(2&t){const r=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,10,r.fieldName)),e.xp6(2),e.Q6J("formControl",r.control)("type",r.shouldPasswordBeHidden?"password":"text"),e.xp6(1),e.uIk("aria-label","Hide password")("aria-pressed",r.shouldPasswordBeHidden),e.xp6(2),e.Oqu(r.shouldPasswordBeHidden?"visibility_off":"visibility"),e.xp6(1),e.Q6J("ngIf",r.control.hasError("required")),e.xp6(1),e.Q6J("ngIf",r.control.hasError("minlength")),e.xp6(1),e.Q6J("ngIf",r.control.hasError("passwordRepetition")),e.xp6(1),e.Q6J("ngIf",r.control.getError("serverError"))}}let R=(()=>{class t{constructor(){this.shouldPasswordBeHidden=!0,this.control=null,this.fieldName=null}changePasswordVisibility(){this.shouldPasswordBeHidden=!this.shouldPasswordBeHidden}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["camp-password-field"]],inputs:{control:"control",fieldName:"fieldName"},decls:1,vars:1,consts:[["class","password-field",4,"ngIf"],[1,"password-field"],["matInput","","autocomplete","current-password",3,"formControl","type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],[4,"ngIf"]],template:function(r,n){1&r&&e.YNc(0,j,12,12,"mat-form-field",0),2&r&&e.Q6J("ngIf",n.control&&n.fieldName)},dependencies:[l.O5,i.Fj,i.JJ,i.oH,m.KE,m.hX,m.TO,m.R9,_.Nt,f.RK,Z.Hw,Q,A],styles:[".password-field[_ngcontent-%COMP%]{width:100%}"]}),t})();function $(t,o){if(1&t&&(e.TgZ(0,"p",7),e._uU(1),e.qZA()),2&t){const r=o.$implicit;e.xp6(1),e.hij(" ",r.detail," ")}}function G(t,o){if(1&t&&(e.ynx(0),e.YNc(1,$,2,1,"p",6),e.BQk()),2&t){const r=o.ngIf,n=e.oxw();e.xp6(1),e.Q6J("ngForOf",r.common)("ngForTrackBy",n.trackErrorByCode)}}function X(t,o){1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"fieldErrorText"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.xi3(2,1,"required","email")))}function K(t,o){1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"fieldErrorText"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"email")))}function V(t,o){if(1&t&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Email"),e.qZA(),e._UZ(3,"input",8),e.YNc(4,X,3,4,"mat-error",2),e.YNc(5,K,3,3,"mat-error",2),e.qZA()),2&t){const r=o.ngIf;e.xp6(3),e.Q6J("formControl",r),e.xp6(1),e.Q6J("ngIf",r.hasError("required")),e.xp6(1),e.Q6J("ngIf",r.hasError("email"))}}function W(t,o){1&t&&e._UZ(0,"camp-shadow-spinner")}let z=(()=>{class t{constructor(){this.isSubmitting$=new x.X(!1),this.loginErrors$=new x.X(null),this.formBuilder=(0,e.f3M)(i.j3),this.authService=(0,e.f3M)(w.e),this.router=(0,e.f3M)(c.F0),this.untilDestroyed=(0,b.t)(),this.form=this.createForm()}ngOnInit(){this.form.valueChanges.pipe(this.untilDestroyed()).subscribe(()=>this.loginErrors$.next(null))}handleSubmit(){"VALID"===this.form.status&&(this.isSubmitting$.next(!0),this.authService.login(this.form.getRawValue()).pipe((0,C.P)(),(0,p.b)(()=>this.router.navigate(["anime"])),I(),(0,p.b)(r=>this.loginErrors$.next(r??null)),(0,N.x)(()=>this.isSubmitting$.next(!1))).subscribe())}createForm(){return this.formBuilder.group({email:["",[i.kI.required,i.kI.email]],password:["",[i.kI.required,i.kI.minLength(u.MIN_PASSWORD_LENGTH)]]})}trackErrorByCode(r,n){return n.code}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["camp-login-page"]],decls:13,vars:9,consts:[[1,"typography-title"],[1,"auth-form",3,"formGroup","ngSubmit"],[4,"ngIf"],["fieldName","password",3,"control"],["type","submit","mat-raised-button","","color","primary",1,"auth-form__submit-button"],["routerLink","/auth/signup","mat-button",""],["class","auth-form__error",4,"ngFor","ngForOf","ngForTrackBy"],[1,"auth-form__error"],["matInput","","placeholder","example@gmail.com","autocomplete","email",3,"formControl"]],template:function(r,n){1&r&&(e.TgZ(0,"p",0),e._uU(1,"Sign in"),e.qZA(),e.TgZ(2,"form",1),e.NdJ("ngSubmit",function(){return n.handleSubmit()}),e.YNc(3,G,2,2,"ng-container",2),e.ALo(4,"async"),e.YNc(5,V,6,3,"mat-form-field",2),e._UZ(6,"camp-password-field",3),e.TgZ(7,"button",4),e._uU(8,"Sign in"),e.qZA()(),e.TgZ(9,"a",5),e._uU(10,"Sign up"),e.qZA(),e.YNc(11,W,1,0,"camp-shadow-spinner",2),e.ALo(12,"async")),2&r&&(e.xp6(2),e.Q6J("formGroup",n.form),e.xp6(1),e.Q6J("ngIf",e.lcZ(4,5,n.loginErrors$)),e.xp6(2),e.Q6J("ngIf",n.form.controls.email),e.xp6(1),e.Q6J("control",n.form.controls.password),e.xp6(5),e.Q6J("ngIf",e.lcZ(12,7,n.isSubmitting$)))},dependencies:[l.sg,l.O5,y.e,c.rH,i._Y,i.Fj,i.JJ,i.JL,i.oH,i.sg,m.KE,m.hX,m.TO,_.Nt,f.zs,f.lW,R,l.Ov,A],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:var(--space-m);padding:var(--space-m)}.auth-form[_ngcontent-%COMP%]{display:flex;max-width:var(--auth-form-max-width);width:100%;flex-direction:column;gap:var(--space-s);justify-content:center}.auth-form__error[_ngcontent-%COMP%]{color:var(--primary-color);align-self:center}.auth-form__submit-button[_ngcontent-%COMP%]{align-self:center}"],changeDetection:0}),t})();var k=s(7969);function te(t,o){1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"fieldErrorText"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.xi3(2,1,"required","email")))}function re(t,o){1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"fieldErrorText"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"email")))}function oe(t,o){if(1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.qZA()),2&t){const r=o.ngIf;e.xp6(1),e.Oqu(r)}}function ne(t,o){if(1&t&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Email"),e.qZA(),e._UZ(3,"input",7),e.YNc(4,te,3,4,"mat-error",2),e.YNc(5,re,3,3,"mat-error",2),e.YNc(6,oe,2,1,"mat-error",2),e.qZA()),2&t){const r=o.ngIf;e.xp6(3),e.Q6J("formControl",r),e.xp6(1),e.Q6J("ngIf",r.hasError("required")),e.xp6(1),e.Q6J("ngIf",r.hasError("email")),e.xp6(1),e.Q6J("ngIf",r.getError("serverError"))}}function ie(t,o){1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"fieldErrorText"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.xi3(2,1,"required","first name")))}function ae(t,o){if(1&t&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"First name"),e.qZA(),e._UZ(3,"input",8),e.YNc(4,ie,3,4,"mat-error",2),e.qZA()),2&t){const r=o.ngIf;e.xp6(3),e.Q6J("formControl",r),e.xp6(1),e.Q6J("ngIf",r.hasError("required"))}}function se(t,o){1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"fieldErrorText"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.xi3(2,1,"required","last name")))}function me(t,o){if(1&t&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Last name"),e.qZA(),e._UZ(3,"input",9),e.YNc(4,se,3,4,"mat-error",2),e.qZA()),2&t){const r=o.ngIf;e.xp6(3),e.Q6J("formControl",r),e.xp6(1),e.Q6J("ngIf",r.hasError("required"))}}function le(t,o){1&t&&e._UZ(0,"camp-shadow-spinner")}let fe=(()=>{class t{constructor(){this.isSubmitting$=new x.X(!1),this.formBuilder=(0,e.f3M)(i.j3),this.authService=(0,e.f3M)(w.e),this.router=(0,e.f3M)(c.F0),this.changeDetectorRef=(0,e.f3M)(e.sBO),this.form=this.createForm()}handleSubmit(){"VALID"===this.form.status&&(this.isSubmitting$.next(!0),this.authService.register(this.form.getRawValue()).pipe((0,C.P)(),(0,p.b)(()=>this.router.navigate(["anime"])),I(),(0,k.U)(r=>r??U),function ee(t){return function(o){return o.pipe((0,p.b)(r=>{Object.keys(r).forEach(n=>{if(void 0!==t.controls[n]){const a=r[n].map(g=>g.detail);t.controls[n].setErrors({[h.AppErrorCode.ServerError]:a.join(", ")})}})}))}}(this.form),(0,p.b)(()=>this.changeDetectorRef.markForCheck()),(0,N.x)(()=>this.isSubmitting$.next(!1))).subscribe())}createForm(){return this.formBuilder.group({email:["",[i.kI.required,i.kI.email]],firstName:["",[i.kI.required]],lastName:["",[i.kI.required]],password:["",[i.kI.required,i.kI.minLength(u.MIN_PASSWORD_LENGTH)]],repeatedPassword:["",[i.kI.required,i.kI.minLength(u.MIN_PASSWORD_LENGTH)]]},{validators:[u.passwordRepetition()]})}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["camp-register-page"]],decls:14,vars:9,consts:[[1,"typography-title"],[1,"auth-form",3,"formGroup","ngSubmit"],[4,"ngIf"],["fieldName","password",3,"control"],["fieldName","repeated password",3,"control"],["type","submit","mat-raised-button","","color","primary",1,"auth-form__submit-button"],["routerLink","/auth/signin","mat-button",""],["matInput","","placeholder","example@gmail.com","autocomplete","email",3,"formControl"],["matInput","","placeholder","John","autocomplete","given-name",3,"formControl"],["matInput","","placeholder","Doe","autocomplete","family-name",3,"formControl"]],template:function(r,n){1&r&&(e.TgZ(0,"p",0),e._uU(1,"Sign up"),e.qZA(),e.TgZ(2,"form",1),e.NdJ("ngSubmit",function(){return n.handleSubmit()}),e.YNc(3,ne,7,4,"mat-form-field",2),e.YNc(4,ae,5,2,"mat-form-field",2),e.YNc(5,me,5,2,"mat-form-field",2),e._UZ(6,"camp-password-field",3)(7,"camp-password-field",4),e.TgZ(8,"button",5),e._uU(9,"Sign up"),e.qZA()(),e.TgZ(10,"a",6),e._uU(11,"Sign in"),e.qZA(),e.YNc(12,le,1,0,"camp-shadow-spinner",2),e.ALo(13,"async")),2&r&&(e.xp6(2),e.Q6J("formGroup",n.form),e.xp6(1),e.Q6J("ngIf",n.form.controls.email),e.xp6(1),e.Q6J("ngIf",n.form.controls.firstName),e.xp6(1),e.Q6J("ngIf",n.form.controls.lastName),e.xp6(1),e.Q6J("control",n.form.controls.password),e.xp6(1),e.Q6J("control",n.form.controls.repeatedPassword),e.xp6(5),e.Q6J("ngIf",e.lcZ(13,7,n.isSubmitting$)))},dependencies:[l.O5,y.e,c.rH,i._Y,i.Fj,i.JJ,i.JL,i.oH,i.sg,m.KE,m.hX,m.TO,_.Nt,f.zs,f.lW,R,l.Ov,A],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:var(--space-m);padding:var(--space-m)}.auth-form[_ngcontent-%COMP%]{display:flex;max-width:var(--auth-form-max-width);width:100%;flex-direction:column;gap:var(--space-s);justify-content:center}.auth-form__error[_ngcontent-%COMP%]{color:var(--primary-color);align-self:center}.auth-form__submit-button[_ngcontent-%COMP%]{align-self:center}"],changeDetection:0}),t})();const ce=[{path:"",redirectTo:"signin",pathMatch:"prefix"},{path:"signin",title:"Sign In",component:z,canActivate:[v.e]},{path:"signup",title:"Sign Up",component:fe,canActivate:[v.e]}];let ue=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[c.Bz.forChild(ce),c.Bz]}),t})(),pe=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[{provide:m.o2,useValue:{appearance:"outline"}}],imports:[l.ez,O.m,ue,i.u5,i.UX,m.lN,_.c,f.ot,Z.Ps]}),t})()}}]);